#!/usr/bin/env bash


cat banner.txt

#
# Turn ./bin/bearded-dragon into an interactive prompt
#

trap ctrl_c INT

function ctrl_c() {
  echo "type 'exit' to exit"
}

if [[ ! -f .history ]]; then
  touch .history
fi

history -r .history
command=`basename $1`

while read -e -p "$command> " opts; do
  [[ "${opts[@]}" == "exit" ]] && break
  if [[ "${opts[@]}" =~ ^listen.* ]]; then
    $1 ${opts[@]} 2>.log >/dev/null &
    echo "View your feed here: http://localhost:3000/dashboard/script/dragon.js?metric=price&from=now-5m&to=now&refresh=1s"
  else
    $1 ${opts[@]}
  fi
  history -s -- ${opts[@]}
done

kill $(jobs -p)
history -a .history
